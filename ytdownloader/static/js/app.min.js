(()=>{"use strict";var O={342:(o,p,i)=>{var m=i(961),l=i(540),r=i(848);function c(n){"@babel/helpers - typeof";return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(n)}function v(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function d(n,t){for(var a=0;a<t.length;a++){var e=t[a];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,y(e.key),e)}}function f(n,t,a){return t&&d(n.prototype,t),a&&d(n,a),Object.defineProperty(n,"prototype",{writable:!1}),n}function y(n){var t=j(n,"string");return c(t)=="symbol"?t:t+""}function j(n,t){if(c(n)!="object"||!n)return n;var a=n[Symbol.toPrimitive];if(a!==void 0){var e=a.call(n,t||"default");if(c(e)!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function _(n,t,a){return t=g(t),C(n,P()?Reflect.construct(t,a||[],g(n).constructor):t.apply(n,a))}function C(n,t){if(t&&(c(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return w(n)}function w(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function P(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(P=function(){return!!n})()}function g(n){return g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},g(n)}function S(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),t&&k(n,t)}function k(n,t){return k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,s){return e.__proto__=s,e},k(n,t)}var D=function(n){function t(a){return v(this,t),_(this,t,[a])}return S(t,n),f(t,[{key:"render",value:function(){var e="Step "+this.props.itemNumber+": ",s=this.props.text,h=this.props.suffix,b,x;return this.props.stateNumber===this.props.stateLoading&&this.props.stateNumber!==this.props.stateDone?(b="has-text-info",x=(0,r.jsx)("i",{className:"fas fa-sync fa-spin"})):this.props.stateNumber>=this.props.stateDone?(b="has-text-success",x=(0,r.jsx)("i",{className:"fas fa-check"})):(b="grey-lighter",x=null),(0,r.jsxs)("span",{className:b,children:[(0,r.jsx)("b",{children:e}),s+" "+h," ",x]})}}])}(l.Component),L=function(n){function t(a){return v(this,t),_(this,t,[a])}return S(t,n),f(t,[{key:"render",value:function(){var e=this,s;return this.props.state!==-1?s=this.props.steps.map(function(h){return(0,r.jsxs)("div",{children:[(0,r.jsx)(D,{itemNumber:h.number,text:h.text,suffix:h.suffix,stateNumber:e.props.state,stateDone:h.stateDone,stateLoading:h.stateLoading}),(0,r.jsx)("br",{})]},h.number)}):s=(0,r.jsxs)("span",{className:"has-text-danger",children:[(0,r.jsx)("b",{children:"Message: "}),"An error has occurred. Please check URL or contact an administrator. Error details: ",this.props.error_code]}),(0,r.jsx)("div",{children:s})}}])}(l.Component),E=function(n){function t(a){var e;return v(this,t),e=_(this,t,[a]),e.state={downloading:!1,url:"",interval:null,jobid:"",state:0,format:"audio_only",message:"",error_retry:0,percent:"0%"},e.handleURLChange=e.handleURLChange.bind(e),e.handleFormatChange=e.handleFormatChange.bind(e),e.handleSubmit=e.handleSubmit.bind(e),e.makeRequest=e.makeRequest.bind(e),e.checkStatus=e.checkStatus.bind(e),e.restart=e.restart.bind(e),e}return S(t,n),f(t,[{key:"handleURLChange",value:function(e){this.setState({url:e.target.value})}},{key:"handleFormatChange",value:function(e){this.setState({format:e.target.value}),console.log(e.target.value)}},{key:"handleSubmit",value:function(e){this.makeRequest(),e.preventDefault()}},{key:"restart",value:function(){this.setState({downloading:!1,url:"",interval:null,jobid:"",state:0,percent:"0%",error_retry:0,message:""})}},{key:"makeRequest",value:function(){var e=this;this.setState({downloading:!0}),fetch("/api/job/request",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:this.state.url,format:this.state.format})}).then(function(s){return s.json()}).then(function(s){s.state==="success"?setTimeout(function(){e.setState({state:1,downloading:!0,interval:setInterval(e.checkStatus,500),jobid:s.id,percent:"0%",error_retry:0})},1e3):e.setState({state:-1,interval:null,message:s.message})},function(s){e.state.error_retry<3?(e.setState({error_retry:e.state.error_retry+1}),e.makeRequest()):e.setState({state:-1,interval:null,message:"Error: "+s})})}},{key:"checkStatus",value:function(){var e=this;this.state.jobid!==null&&fetch("/api/job/status",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:this.state.jobid})}).then(function(s){return s.json()}).then(function(s){console.log(s),s.state==="downloading"&&e.state.state!==2?e.setState({state:2,percent:s.percent,error_retry:0}):s.state==="downloading"&&e.state.state===2?e.setState({percent:s.percent,error_retry:0}):s.state==="processing"&&e.state.state!==3?e.setState({state:3,percent:"100%",error_retry:0}):s.state==="done"&&e.state.state!==4?e.setState({state:4,interval:clearInterval(e.state.interval),percent:"100%",error_retry:0}):s.state==="error"&&(e.state.error_retry>5?e.setState({state:-1,interval:clearInterval(e.state.interval),message:s.message,error_retry:0}):e.setState({error_retry:e.state.error_retry+1}))},function(s){e.state.error_retry>5?e.setState({state:-1,interval:clearInterval(e.state.interval),message:"Error: "+s,error_retry:0}):e.setState({error_retry:e.state.error_retry+1})})}},{key:"render",value:function(){var e,s,h=null;if(this.state.downloading){var b=[{number:1,text:"Queue download request",suffix:"",stateLoading:1,stateDone:2},{number:2,text:"Video downloading on server",suffix:"("+this.state.percent+")",stateLoading:2,stateDone:3},{number:3,text:"Post-processing and conversion",suffix:"",stateLoading:3,stateDone:4},{number:4,text:"Read to download",suffix:"",stateLoading:4,stateDone:4}];s=(0,r.jsx)(L,{state:this.state.state,steps:b,error_code:this.state.message}),this.state.state===4?h=(0,r.jsxs)("div",{className:"field is-grouped mt-1",children:[(0,r.jsx)("p",{className:"control",children:(0,r.jsx)("a",{className:"button is-info",download:!0,href:"/api/job/download/"+this.state.jobid+"/"+this.state.format,children:"Download"})}),(0,r.jsx)("p",{className:"control",children:(0,r.jsx)("input",{className:"button is-info",value:"Reset",type:"reset"})})]}):this.state.state===-1&&(h=(0,r.jsx)("div",{className:"field is-grouped mt-1",children:(0,r.jsx)("p",{className:"control",children:(0,r.jsx)("input",{className:"button is-info",value:"Reset",type:"reset"})})})),e=(0,r.jsxs)("div",{className:"",children:[(0,r.jsx)("div",{className:"container",children:s}),h]})}return(0,r.jsxs)("form",{onSubmit:this.handleSubmit,onReset:this.restart,children:[(0,r.jsxs)("div",{className:"field has-addons has-addons-centered",children:[(0,r.jsx)("div",{className:"control",children:(0,r.jsx)("span",{className:"select",children:(0,r.jsxs)("select",{disabled:this.state.downloading,onChange:this.handleFormatChange,value:this.state.format,children:[(0,r.jsx)("option",{value:"audio_only",children:"Audio Only"}),(0,r.jsx)("option",{value:"video_only",children:"Video Only"}),(0,r.jsx)("option",{value:"both",children:"Audio + Video"})]})})}),(0,r.jsx)("div",{className:"control is-expanded",children:(0,r.jsx)("input",{className:"input",disabled:this.state.downloading,type:"text",placeholder:"Source URL",onChange:this.handleURLChange,value:this.state.url})}),(0,r.jsx)("div",{className:"control",children:(0,r.jsx)("button",{disabled:this.state.downloading,className:"button is-info",children:"Download"})})]}),e]})}}])}(l.Component);const T=E;m.render(T,document.getElementById("download_form"))}},N={};function u(o){var p=N[o];if(p!==void 0)return p.exports;var i=N[o]={exports:{}};return O[o](i,i.exports,u),i.exports}u.m=O,(()=>{var o=[];u.O=(p,i,m,l)=>{if(i){l=l||0;for(var r=o.length;r>0&&o[r-1][2]>l;r--)o[r]=o[r-1];o[r]=[i,m,l];return}for(var c=1/0,r=0;r<o.length;r++){for(var[i,m,l]=o[r],v=!0,d=0;d<i.length;d++)(l&!1||c>=l)&&Object.keys(u.O).every(w=>u.O[w](i[d]))?i.splice(d--,1):(v=!1,l<c&&(c=l));if(v){o.splice(r--,1);var f=m();f!==void 0&&(p=f)}}return p}})(),u.o=(o,p)=>Object.prototype.hasOwnProperty.call(o,p),(()=>{var o={524:0};u.O.j=m=>o[m]===0;var p=(m,l)=>{var[r,c,v]=l,d,f,y=0;if(r.some(_=>o[_]!==0)){for(d in c)u.o(c,d)&&(u.m[d]=c[d]);if(v)var j=v(u)}for(m&&m(l);y<r.length;y++)f=r[y],u.o(o,f)&&o[f]&&o[f][0](),o[f]=0;return u.O(j)},i=self.webpackChunkytdownload=self.webpackChunkytdownload||[];i.forEach(p.bind(null,0)),i.push=p.bind(null,i.push.bind(i))})();var R=u.O(void 0,[96],()=>u(342));R=u.O(R)})();

//# sourceMappingURL=app.min.js.map