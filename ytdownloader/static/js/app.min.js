(()=>{"use strict";var O={811:(a,u,s)=>{var f=s(961),e=s(540);const v=n=>{const h="Step "+n.itemNumber+": ",c=n.text,N=n.suffix;var i,l;return n.stateNumber===n.stateLoading&&n.stateNumber!==n.stateDone?(i="has-text-info",l=e.createElement("i",{className:"fas fa-sync fa-spin"})):n.stateNumber>=n.stateDone?(i="has-text-success",l=e.createElement("i",{className:"fas fa-check"})):(i="grey-lighter",l=null),e.createElement("span",{className:i},e.createElement("b",null,h),c+" "+N," ",l)},d=n=>{let h=null;return n.state!==-1?h=n.steps.map(c=>e.createElement("div",{key:c.number},e.createElement(v,{itemNumber:c.number,text:c.text,suffix:c.suffix,stateNumber:n.state,stateDone:c.stateDone,stateLoading:c.stateLoading}),e.createElement("br",null))):h=e.createElement("span",{className:"has-text-danger"},e.createElement("b",null,"Message: "),"An error has occurred. Please check URL or contact an administrator. Error details: ",n.error_code),e.createElement("div",null,h)},w=()=>{const[n,h]=(0,e.useState)(!1),[c,N]=(0,e.useState)(""),[i,l]=(0,e.useState)(0),[k,C]=(0,e.useState)("audio_only"),[P,x]=(0,e.useState)(""),[E,m]=(0,e.useState)(0),[B,p]=(0,e.useState)("0%"),[y,_]=(0,e.useState)(""),[J,M]=(0,e.useState)(""),T=()=>{h(!1),N(""),_(""),l(0),p("0%"),x(""),m(0)},R=()=>{h(!0),fetch("/api/job/request",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:c,format:k})}).then(t=>t.json()).then(t=>{t.state==="success"?(l(1),h(!0),_(t.id),p("0%"),m(0),M(t.id)):(_(""),l(-1),x(t.message))},t=>{E<3?(m(E+1),R()):(_(""),l(-1),x("Error: "+t))})},q=()=>{console.log("status update called"),y!==null&&fetch("/api/job/status",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:y})}).then(t=>t.json()).then(t=>{t.state==="downloading"&&i!==2?(l(2),p(t.percent),m(0)):t.state==="downloading"&&i===2?(p(t.percent),m(0)):t.state==="processing"&&i!==3?(l(3),p("100%"),m(0)):t.state==="done"&&i!==4?(l(4),p("100%"),m(0),_("")):t.state==="error"&&(E>5?(_(""),l(-1),x(t.message),m(0)):m(E+1))},t=>{E>5?(_(""),l(-1),x("Error: "+t),m(0)):m(E+1)})};(0,e.useEffect)(()=>{if(y==="")return;const t=setInterval(()=>{q()},500);return()=>clearInterval(t)},[y,E,i]);let I,D=null;if(n){var A=[{number:1,text:"Queue download request",suffix:"",stateLoading:1,stateDone:2},{number:2,text:"Video downloading on server",suffix:"("+B+")",stateLoading:2,stateDone:3},{number:3,text:"Post-processing and conversion",suffix:"",stateLoading:3,stateDone:4},{number:4,text:"Read to download",suffix:"",stateLoading:4,stateDone:4}];I=e.createElement(d,{state:i,steps:A,error_code:P}),i===4?D=e.createElement("div",{className:"field is-grouped mt-1"},e.createElement("p",{className:"control"},e.createElement("a",{className:"button is-info",download:!0,href:`/api/job/download/${J}/${k}`},"Download")),e.createElement("p",{className:"control"},e.createElement("input",{className:"button is-info",value:"Reset",type:"reset"}))):i===-1&&(D=e.createElement("div",{className:"field is-grouped mt-1"},e.createElement("p",{className:"control"},e.createElement("input",{className:"button is-info",value:"Reset",type:"reset"}))))}return e.createElement("form",{onSubmit:t=>{t.preventDefault(),R()},onReset:T},e.createElement("div",{className:"field has-addons has-addons-centered"},e.createElement("div",{className:"control"},e.createElement("span",{className:"select"},e.createElement("select",{disabled:n,onChange:t=>C(t.target.value),value:k},e.createElement("option",{value:"audio_only"},"Audio Only"),e.createElement("option",{value:"video_only"},"Video Only"),e.createElement("option",{value:"both"},"Audio + Video")))),e.createElement("div",{className:"control is-expanded"},e.createElement("input",{className:"input",required:!0,disabled:n,type:"text",placeholder:"Source URL",onChange:t=>N(t.target.value),value:c})),e.createElement("div",{className:"control"},e.createElement("button",{disabled:n,className:"button is-info"},"Download"))),e.createElement("div",{className:""},e.createElement("div",{className:"container"},I),D))};var S=s(848);f.render((0,S.jsx)(w,{}),document.getElementById("download_form"))}},L={};function r(a){var u=L[a];if(u!==void 0)return u.exports;var s=L[a]={exports:{}};return O[a](s,s.exports,r),s.exports}r.m=O,(()=>{var a=[];r.O=(u,s,f,e)=>{if(s){e=e||0;for(var o=a.length;o>0&&a[o-1][2]>e;o--)a[o]=a[o-1];a[o]=[s,f,e];return}for(var v=1/0,o=0;o<a.length;o++){for(var[s,f,e]=a[o],g=!0,d=0;d<s.length;d++)(e&!1||v>=e)&&Object.keys(r.O).every(c=>r.O[c](s[d]))?s.splice(d--,1):(g=!1,e<v&&(v=e));if(g){a.splice(o--,1);var b=f();b!==void 0&&(u=b)}}return u}})(),r.o=(a,u)=>Object.prototype.hasOwnProperty.call(a,u),(()=>{var a={524:0};r.O.j=f=>a[f]===0;var u=(f,e)=>{var[o,v,g]=e,d,b,w=0;if(o.some(n=>a[n]!==0)){for(d in v)r.o(v,d)&&(r.m[d]=v[d]);if(g)var S=g(r)}for(f&&f(e);w<o.length;w++)b=o[w],r.o(a,b)&&a[b]&&a[b][0](),a[b]=0;return r.O(S)},s=self.webpackChunkytdownload=self.webpackChunkytdownload||[];s.forEach(u.bind(null,0)),s.push=u.bind(null,s.push.bind(s))})();var j=r.O(void 0,[96],()=>r(811));j=r.O(j)})();

//# sourceMappingURL=app.min.js.map